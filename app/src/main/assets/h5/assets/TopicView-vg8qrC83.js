import{d as x,r as a,a as N,o as T,c as r,b as n,t as u,w as g,e as s,u as h,g as p,h as k,n as j,i as v}from"./index-7eRT9hrs.js";import{c as l,R,E as D,_ as E,C as J,B as M,a as H,W as L}from"./BottomSpinnerView-r3MJ3GpY.js";const U={key:0,class:"topic",id:"topic"},A={class:"topic-title"},O=["onClick"],z={class:"topic-author"},F={class:"topic-time"},W=["innerHTML"],X={key:0,class:"emoji"},Y=n("div",{style:{flex:"1"}},null,-1),q={key:1,class:"divider"},y=10,Z=x({__name:"TopicView",setup(G){const o=a({}),w=a(),_=a(new Date().getDate()),m=a(1),d=a("desc"),c=N([]),C=a("哼！Bangumi老娘我是有底线的人"),V={loadTopicDetail:async e=>{o.value=e,await j(),l.optContentJs(w.value)}},S=async e=>{const t=window.android.onLoadComments(m.value,y,d.value),i=JSON.parse(t);i.length==0?e.complete():(await l.delay(200),c.push(...i),m.value++,await j(),i.length<y?e.complete():e.loaded())},f=e=>{var t;return{emojiParam:e.emojiParam,id:(t=e.emojiParam)==null?void 0:t.likeCommentId,gh:e.gh}},B=e=>{let t=f(o.value);window.android&&window.android.onClickCommentAction(JSON.stringify(t),e.clientX,e.clientY)},I=(e,t)=>{e==o.value.emojiParam.likeCommentId&&(o.value.emojis=t)},P=()=>{var t,i;const e=((t=o.value)==null?void 0:t.userId)||"";window.android&&e&&window.android&&window.android.onClickUser(e,(i=o.value)==null?void 0:i.id)};return T(()=>{window.robotSay=e=>{C.value=e},l.initComment(I,()=>c,e=>{d.value=e,m.value=1,c.length=0,_.value++}),window.topic=V,window.mounted=!0}),(e,t)=>{var i;return o.value.id?(v(),r("div",U,[n("div",A,u(o.value.title),1),n("div",{class:"topic-info",onClick:g(P,["stop"])},[n("div",z,u(o.value.userName),1),n("div",F,u(o.value.time),1)],8,O),s(R,{related:o.value.related},null,8,["related"]),n("div",{class:"topic-content",ref_key:"topicContentRef",ref:w,innerHTML:h(l).optText(o.value.content)},null,8,W),(i=o.value.emojiParam)!=null&&i.enable?(v(),r("div",X,[s(D,{class:"topic-emoji",emojis:o.value.emojis,comment:f(o.value)},null,8,["emojis","comment"]),Y,n("img",{class:"action",smileid:"",src:E,alt:"action",onClick:t[0]||(t[0]=g(b=>B(b),["stop"]))})])):p("",!0),o.value.content?(v(),r("div",q)):p("",!0),s(J,{target:"#topic",comments:c,sort:d.value},null,8,["comments","sort"]),s(h(L),{class:"loading",target:"#topic",identifier:_.value,distance:300,onInfinite:S},{spinner:k(()=>[s(M)]),complete:k(()=>[s(H,{message:C.value},null,8,["message"])]),_:1},8,["identifier"])])):p("",!0)}}});export{Z as default};
