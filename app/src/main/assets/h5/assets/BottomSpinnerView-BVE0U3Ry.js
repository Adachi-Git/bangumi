import{d as I,j as K,k as $,o as A,i as f,c as g,b as c,u as C,_ as R,t as k,F as j,f as L,g as b,w as y,e as S,r as q,p as T,l as V,m as Q,q as U,s as X,v as Z,x as tt,y as et,z as M,n as W}from"./index-8aWKy8mL.js";const st={class:"image-container"},ot=["src"],nt=I({__name:"ImageView",props:{src:{type:String},width:{type:String,default:"100%"},height:{type:String,default:"100%"}},setup(t){K(i=>({"4123973e":C(o),"16ed4428":C(n)}));const s=t,{src:e,width:o,height:n}=$(s),d=async i=>{const l=i.currentTarget;l.src="/ic_holder.jpg"};return A(()=>{console.log("Component mounted")}),(i,l)=>(f(),g("div",st,[c("img",{class:"image",src:C(e),alt:"Image",onError:l[0]||(l[0]=u=>d(u))},null,40,ot)]))}}),J=R(nt,[["__scopeId","data-v-b3953fd3"]]),it={key:0,class:"relative"},rt={class:"relative-subject"},ct={class:"tip"},lt=["onClick"],at={class:"title"},dt=I({__name:"RelativeItemView",props:{related:{type:Object,required:!1}},setup(t){const s=t,{related:e}=$(s),o=n=>{window.android&&window.android.onClickRelated(JSON.stringify(n))};return(n,d)=>C(e)&&C(e).items.length?(f(),g("div",it,[c("div",rt,[c("div",ct,k(C(e).title),1),(f(!0),g(j,null,L(C(e).items,i=>(f(),g("div",{class:"relative",onClick:y(l=>o(i),["stop"])},[S(J,{class:"cover",height:"44px",width:"44px",src:i.image},null,8,["src"]),c("div",at,"# "+k(i.title),1)],8,lt))),256))])])):b("",!0)}}),me=R(dt,[["__scopeId","data-v-1217f2f5"]]),pt=t=>(T("data-v-3540c0b3"),t=t(),V(),t),ut={class:"robot"},mt=pt(()=>c("div",{style:{flex:"1"}},null,-1)),_t={class:"message"},ft=I({__name:"BottomRobotView",props:{message:{type:String,required:!0}},setup(t){const s=t,{message:e}=$(s),o=q(),n=["robot-1","robot-2","robot-3","robot-4","robot-5","robot-6"];return A(()=>{var i;const d=Math.floor(Math.random()*n.length);return(i=o.value)==null?void 0:i.classList.add(n[d])}),(d,i)=>(f(),g("div",ut,[mt,c("div",{class:"robot-pic",ref_key:"robot",ref:o},null,512),c("div",_t,k(C(e)),1)]))}}),_e=R(ft,[["__scopeId","data-v-3540c0b3"]]),H="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1702628742133'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='7098'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='24'%20height='24'%3e%3cpath%20d='M863.701333%20202.965333a256%20256%200%200%201%2010.069334%20351.402667l-346.709334%20347.221333a21.333333%2021.333333%200%200%201-30.208%200l-346.624-347.221333a256%20256%200%200%201%20361.813334-361.130667%20255.914667%20255.914667%200%200%201%20351.658666%209.728zM220.672%20263.338667a170.666667%20170.666667%200%200%200-8.192%20232.576L512%20795.904l299.52-299.946667a170.666667%20170.666667%200%200%200-240.896-240.64L421.504%20404.48a42.666667%2042.666667%200%200%201-60.373333-60.373333l90.368-90.410667-3.498667-2.944a170.666667%20170.666667%200%200%200-227.328%2012.586667z'%20fill='%23000000'%20p-id='7099'%3e%3c/path%3e%3c/svg%3e";function gt(t){if(!t)return;const s=t.querySelectorAll("img"),e=[];for(let o=0;o<s.length;o++){const n=s[o],d=n.src;d!=null&&d.length>0&&d.indexOf("/img/smiles")==-1&&(e.push(d),n.onclick=()=>{window.android&&window.android.onPreviewImage(d,e)})}t.querySelectorAll("span.text_mask").forEach(o=>{const n=o;n.onclick=d=>{d.preventDefault(),F(d.currentTarget)}})}const vt=t=>{if(F(t))return!0;const s=t.tagName.toLowerCase();if(s=="a")return!0;if(s=="img"&&window.android){const e=t;return e.getAttribute("smileid")==null&&window.android.onPreviewImage(e.src,[e.src]),!0}return!1},F=t=>{const s=O(t,".text_mask");return s?(s.classList.contains("show")?s.classList.remove("show"):s.classList.add("show"),!0):!1},O=(t,s,e=3,o=0)=>!t||o>e?null:t.matches(s)?t:O(t.parentElement,s,e,o+1),ht=(t,s,e)=>{const o=t.currentTarget;if(o&&s){const n=o.getBoundingClientRect();s.scrollTo({top:s.scrollTop+n.top-(e?40:10),behavior:"smooth"});const d=O(o,".comment-item",5);if(d!=null){const i=()=>{d.classList.remove("blinking"),d.removeEventListener("animationend",i)};d.classList.add("blinking"),d.addEventListener("animationend",i)}}},wt=(t,s)=>{let e=s.replace(/<div class="quote">([^^]*?)<\/div>/,"").replace(/<span class="text_mask" style="([^^]*?)">([^^]*?)<\/span>/,"").replace(/<\/?[^>]+>/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/\B@([^\W_]\w*)\b/g,"＠$1");return e.length>100&&(e=e.slice(0,100)+"..."),"[quote][b]"+t+"[/b] 说: "+e+"[/quote]"},yt=t=>"　　"+(t||"").trim().replace(/&nbsp;/g," ").trim();async function kt(t){return new Promise(s=>setTimeout(s,t))}const Ct=(t,s,e)=>{const o=l=>{for(const u in l){const _=l[u];let v=!1;if(s().forEach(a=>{a.id==u&&(v=!0)}),!v){const a=_.pst_id,m=_.pst_uid,r=z(_,a,m,!1);s().unshift(r)}}},n=l=>{for(const u in l){const _=l[u];let v=null;if(s().forEach(a=>{a.id==u&&(v=a)}),v!=null){const a=v,m=a.id,r=a.userId,w=a.topicSubReply.map(h=>h.id),p=_.map(h=>z(h,m,r,!0)).filter(h=>!w.includes(h.id));a.topicSubReply.push(...p)}}},d=l=>{var v,a;const u=(v=l.posts)==null?void 0:v.main;u!=null&&o(u);const _=(a=l.posts)==null?void 0:a.sub;_!=null&&n(_)},i=l=>{console.log("刷新贴贴："+JSON.stringify(l,null,2));for(const u in l){const _=l[u];t&&t(u,_),s().forEach(v=>{v.id==u&&(v.emojis=_||[]),v.topicSubReply.forEach(a=>{a.id==u&&(a.emojis=_||[])})})}};window.comment={addComment:d,refreshEmoji:i,changeSort:e}},z=(t,s,e,o=!1)=>{const n={},d=o?1:0,i=o?t.pst_id:0,l=t.pst_uid,u=t.avatar||"";return n.id=t.pst_id,n.time=t.dateline,n.userAvatar=u.startsWith("//")?"https:"+u:u,n.userName=t.nickname,n.userId=t.username,n.replyContent=t.pst_content,n.replyJs=`subReply('${t.model}', ${t.pst_mid}, ${s}, ${i}, ${l}, ${e}, ${d})`,n.topicSubReply=[],n.emojiParam={enable:!1},n.emojis=[],n},E={optContentJs:gt,optText:yt,optReplyItemClick:vt,optReplyContent:wt,scrollIntoView:ht,delay:kt,initComment:Ct},xt={class:"emoji-container"},It=["onClick"],$t=["src"],St={class:"user-count"},bt=I({__name:"EmojiView",props:{emojis:{type:Array,required:!0},comment:{type:Object,required:!0}},setup(t){const s=t,{emojis:e,comment:o}=$(s),n=i=>{try{const l=parseInt(i);return l===0?"https://bgm.tv/img/smiles/tv/44.gif":`https://bgm.tv/img/smiles/tv/${l-39}.gif`}catch{return""}},d=i=>{const l=o==null?void 0:o.value;window.android.onToggleSmile(l.id,JSON.stringify(i))};return(i,l)=>(f(),g("div",xt,[(f(!0),g(j,null,L(C(e),u=>(f(),g("div",{class:Q(["emoji",{selected:u.selected}]),key:u.value,onClick:y(_=>d(u),["stop"])},[c("img",{class:"smile",src:n(u.value),alt:"smile"},null,8,$t),c("span",St,k(u.users.length),1)],10,It))),128))]))}}),D=R(bt,[["__scopeId","data-v-deb04d93"]]),N=t=>(T("data-v-377a08e1"),t=t(),V(),t),Rt={class:"comment"},Et={class:"comment-title"},jt=N(()=>c("div",{class:"title"},"用户讨论",-1)),Lt=["onClick"],Tt=N(()=>c("div",{style:{flex:"1"}},null,-1)),Vt={class:"comment-content"},Nt=["onClick"],Bt=["onClick"],Mt={class:"time"},qt={class:"floor"},Jt=N(()=>c("div",{style:{flex:"1"}},null,-1)),At=["onClick"],Ot=["innerHTML","onClick"],Pt=["onClick"],Ut={class:"info"},Ht=["onClick"],zt={class:"time"},Dt={class:"floor"},Gt=N(()=>c("div",{style:{flex:"1"}},null,-1)),Wt=["onClick"],Ft=["innerHTML"],Yt=I({__name:"CommentView",props:{target:{type:String,required:!0},comments:{type:Array,default:[],required:!0},sort:{type:String,required:!0}},setup(t){const s=t,{target:e,comments:o,sort:n}=$(s),d=a=>{switch(a){case"desc":return"最新";case"hot":return"最热";case"asc":return"时间";default:return"默认"}},i=a=>{window.android&&a.userId&&window.android&&window.android.onClickUser(a.userId,a.id)},l=(a,m,r)=>{const w=a.target;if(E.optReplyItemClick(w))return;E.scrollIntoView(a,document.querySelector(e==null?void 0:e.value),r==null);const p=(r==null?void 0:r.replyJs)||"",h=m.replyJs||"",x=p.length>0,P=x?p:h,B=r||m;if(window.android){if(P.length>0){x&&(B.replyQuote=E.optReplyContent(B.userName,B.replyContent)),window.android.onReplyUser(p.length>0?p:P,JSON.stringify(r||m));return}window.android.onNeedLogin()}},u=()=>{window.android&&window.android.onClickCommentSort()},_=(a,m)=>{window.android&&window.android.onClickCommentAction(JSON.stringify(m),a.clientX,a.clientY)},v=a=>{E.scrollIntoView(a,document.querySelector(e==null?void 0:e.value),!0),window.android&&window.android.onReplyNew()};return(a,m)=>(f(),g("div",Rt,[c("div",Et,[jt,c("div",{class:"sort",onClick:y(u,["stop"])},"排序："+k(d(C(n))),9,Lt),Tt,c("div",{class:"write",onClick:m[0]||(m[0]=y(r=>v(r),["stop"]))},"写留言")]),(f(!0),g(j,null,L(C(o),r=>{var w;return f(),g("div",{class:"comment-item",key:r.id},[S(J,{class:"avatar",width:"36px",height:"36px",src:r.userAvatar,onClick:y(p=>i(r),["stop"])},null,8,["src","onClick"]),c("div",Vt,[c("div",{class:"info",onClick:y(p=>l(p,r,null),["stop"])},[c("div",{class:"user-name",onClick:y(p=>i(r),["stop"])},k(r.userName),9,Bt),c("div",Mt,[U(k(r.time),1),c("span",qt,k(r.floor),1)]),Jt,(w=r.emojiParam)!=null&&w.enable?(f(),g("img",{key:0,class:"action",smileid:"",src:H,alt:"action",onClick:y(p=>_(p,r),["stop"])},null,8,At)):b("",!0)],8,Nt),c("div",{class:"topic-html",innerHTML:r.replyContent,onClick:y(p=>l(p,r,null),["stop"])},null,8,Ot),S(D,{emojis:r.emojis,comment:r,style:{"margin-top":"16px"}},null,8,["emojis","comment"]),(f(!0),g(j,null,L(r.topicSubReply||[],p=>{var h;return f(),g("div",{class:"comment-item",key:p.id},[S(J,{class:"avatar",height:"24px",width:"24px",src:p.userAvatar,onClick:y(x=>i(p),["stop"])},null,8,["src","onClick"]),c("div",{class:"comment-content",onClick:y(x=>l(x,r,p),["stop"])},[c("div",Ut,[c("div",{class:"user-name sub",onClick:y(x=>i(p),["stop"])},k(p.userName),9,Ht),c("div",zt,[U(k(p.time),1),c("span",Dt,k(p.floor),1)]),Gt,(h=p.emojiParam)!=null&&h.enable?(f(),g("img",{key:0,class:"action",smileid:"",src:H,alt:"action",onClick:y(x=>_(x,p),["stop"])},null,8,Wt)):b("",!0)]),c("div",{class:"topic-html",innerHTML:p.replyContent},null,8,Ft),S(D,{emojis:p.emojis,comment:r,style:{"margin-top":"16px"}},null,8,["emojis","comment"])],8,Pt)])}),128))])])}),128))]))}}),fe=R(Yt,[["__scopeId","data-v-377a08e1"]]);function Kt(t,s){const e=t.getBoundingClientRect();if(!s)return e.top>=0&&e.bottom<=window.innerHeight;const o=s.getBoundingClientRect();return e.top>=o.top&&e.bottom<=o.bottom}async function Qt(t){return await W(),t.value instanceof HTMLElement?t.value:t.value?document.querySelector(t.value):null}function G(t){let s=`0px 0px ${t.distance}px 0px`;t.top&&(s=`${t.distance}px 0px 0px 0px`);const e=new IntersectionObserver(o=>{o[0].isIntersecting&&(t.firstload&&t.emit(),t.firstload=!0)},{root:t.parentEl,rootMargin:s});return e.observe(t.infiniteLoading.value),e}const Y=(t,s)=>{const e=t.__vccOpts||t;for(const[o,n]of s)e[o]=n;return e},Xt={},Zt=t=>(T("data-v-d3e37633"),t=t(),V(),t),te={class:"container"},ee=Zt(()=>c("div",{class:"spinner"},null,-1)),se=[ee];function oe(t,s){return f(),g("div",te,se)}const ne=Y(Xt,[["render",oe],["__scopeId","data-v-d3e37633"]]),ie={class:"state-error"},re=I({__name:"InfiniteLoading",props:{top:{type:Boolean,default:!1},target:{},distance:{default:0},identifier:{},firstload:{type:Boolean,default:!0},slots:{}},emits:["infinite"],setup(t,{emit:s}){const e=t;let o=null,n=0;const d=q(null),i=q(""),{top:l,firstload:u,distance:_}=e,{identifier:v,target:a}=$(e),m={infiniteLoading:d,top:l,firstload:u,distance:_,parentEl:null,emit(){n=(m.parentEl||document.documentElement).scrollHeight,r.loading(),s("infinite",r)}},r={loading(){i.value="loading"},async loaded(){i.value="loaded";const w=m.parentEl||document.documentElement;await W(),l&&(w.scrollTop=w.scrollHeight-n),Kt(d.value,m.parentEl)&&m.emit()},complete(){i.value="complete",o==null||o.disconnect()},error(){i.value="error"}};return X(v,()=>{o==null||o.disconnect(),o=G(m)}),A(async()=>{m.parentEl=await Qt(a),o=G(m)}),Z(()=>{o==null||o.disconnect()}),(w,p)=>(f(),g("div",{ref_key:"infiniteLoading",ref:d,style:{"min-height":"1px"}},[tt(c("div",null,[M(w.$slots,"spinner",{},()=>[S(ne)],!0)],512),[[et,i.value=="loading"]]),i.value=="complete"?M(w.$slots,"complete",{key:0},()=>{var h;return[c("span",null,k(((h=w.slots)==null?void 0:h.complete)||"No more results!"),1)]},!0):b("",!0),i.value=="error"?M(w.$slots,"error",{key:1,retry:m.emit},()=>{var h;return[c("span",ie,[c("span",null,k(((h=w.slots)==null?void 0:h.error)||"Oops something went wrong!"),1),c("button",{class:"retry",onClick:p[0]||(p[0]=(...x)=>m.emit&&m.emit(...x))},"retry")])]},!0):b("",!0)],512))}}),ge=Y(re,[["__scopeId","data-v-a7077831"]]),ce=t=>(T("data-v-18fb154c"),t=t(),V(),t),le={key:0,class:"spinner-container"},ae=ce(()=>c("div",{class:"spinner"},null,-1)),de=[ae],pe=I({__name:"BottomSpinnerView",props:{show:{type:Boolean,default:!0}},setup(t){const s=t,{show:e}=$(s);return(o,n)=>C(e)?(f(),g("div",le,de)):b("",!0)}}),ve=R(pe,[["__scopeId","data-v-18fb154c"]]);export{ve as B,fe as C,D as E,me as R,ge as W,H as _,_e as a,E as c};
