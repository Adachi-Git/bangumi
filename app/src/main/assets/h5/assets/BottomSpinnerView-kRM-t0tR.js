import{d as S,j as Q,k as $,o as A,i as m,c as h,b as n,u as C,_ as R,t as k,F as j,f as T,g as x,w as y,e as b,r as M,p as L,l as V,m as W,q as U,s as X,v as Z,x as tt,y as et,z as B,n as F}from"./index-En1h9jub.js";const st={class:"image-container"},ot=["src"],nt=S({__name:"ImageView",props:{src:{type:String},width:{type:String,default:"100%"},height:{type:String,default:"100%"}},setup(t){Q(c=>({"4123973e":C(o),"16ed4428":C(i)}));const e=t,{src:s,width:o,height:i}=$(e),u=async c=>{const l=c.currentTarget;l.src="/ic_holder.jpg"};return A(()=>{console.log("Component mounted")}),(c,l)=>(m(),h("div",st,[n("img",{class:"image",src:C(s),alt:"Image",onError:l[0]||(l[0]=p=>u(p))},null,40,ot)]))}}),J=R(nt,[["__scopeId","data-v-b3953fd3"]]),it={key:0,class:"relative"},rt={class:"relative-subject"},ct={class:"tip"},lt=["onClick"],at={class:"title"},dt=S({__name:"RelativeItemView",props:{related:{type:Object,required:!1}},setup(t){const e=t,{related:s}=$(e),o=i=>{window.android&&window.android.onClickRelated(JSON.stringify(i))};return(i,u)=>C(s)&&C(s).items.length?(m(),h("div",it,[n("div",rt,[n("div",ct,k(C(s).title),1),(m(!0),h(j,null,T(C(s).items,c=>(m(),h("div",{class:"relative",onClick:y(l=>o(c),["stop"])},[b(J,{class:"cover",height:"44px",width:"44px",src:c.image},null,8,["src"]),n("div",at,"# "+k(c.title),1)],8,lt))),256))])])):x("",!0)}}),Ce=R(dt,[["__scopeId","data-v-1217f2f5"]]),ut=t=>(L("data-v-3540c0b3"),t=t(),V(),t),pt={class:"robot"},_t=ut(()=>n("div",{style:{flex:"1"}},null,-1)),mt={class:"message"},ht=S({__name:"BottomRobotView",props:{message:{type:String,required:!0}},setup(t){const e=t,{message:s}=$(e),o=M(),i=["robot-1","robot-2","robot-3","robot-4","robot-5","robot-6"];return A(()=>{var c;const u=Math.floor(Math.random()*i.length);return(c=o.value)==null?void 0:c.classList.add(i[u])}),(u,c)=>(m(),h("div",pt,[_t,n("div",{class:"robot-pic",ref_key:"robot",ref:o},null,512),n("div",mt,k(C(s)),1)]))}}),Ie=R(ht,[["__scopeId","data-v-3540c0b3"]]),H="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1702628742133'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='7098'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='24'%20height='24'%3e%3cpath%20d='M863.701333%20202.965333a256%20256%200%200%201%2010.069334%20351.402667l-346.709334%20347.221333a21.333333%2021.333333%200%200%201-30.208%200l-346.624-347.221333a256%20256%200%200%201%20361.813334-361.130667%20255.914667%20255.914667%200%200%201%20351.658666%209.728zM220.672%20263.338667a170.666667%20170.666667%200%200%200-8.192%20232.576L512%20795.904l299.52-299.946667a170.666667%20170.666667%200%200%200-240.896-240.64L421.504%20404.48a42.666667%2042.666667%200%200%201-60.373333-60.373333l90.368-90.410667-3.498667-2.944a170.666667%20170.666667%200%200%200-227.328%2012.586667z'%20fill='%23000000'%20p-id='7099'%3e%3c/path%3e%3c/svg%3e";function ft(t){if(!t)return;const e=t.querySelectorAll("img"),s=[];for(let o=0;o<e.length;o++){const i=e[o],u=i.src;u!=null&&u.length>0&&u.indexOf("/img/smiles")==-1&&(s.push(u),i.onclick=()=>{window.android&&window.android.onPreviewImage(u,s)})}t.querySelectorAll("span.text_mask").forEach(o=>{const i=o;i.onclick=u=>{u.preventDefault(),Y(u.currentTarget)}})}const gt=t=>{if(Y(t))return!0;const e=t.tagName.toLowerCase();if(e=="a")return!0;if(e=="img"&&window.android){const s=t;return s.getAttribute("smileid")==null&&window.android.onPreviewImage(s.src,[s.src]),!0}return!1},Y=t=>{const e=O(t,".text_mask");return e?(e.classList.contains("show")?e.classList.remove("show"):e.classList.add("show"),!0):!1},O=(t,e,s=3,o=0)=>!t||o>s?null:t.matches(e)?t:O(t.parentElement,e,s,o+1),vt=(t,e,s)=>{const o=t.currentTarget;if(o&&e){const i=o.getBoundingClientRect();e.scrollTo({top:e.scrollTop+i.top-(s?40:10),behavior:"smooth"});const u=O(o,".comment-item",5);if(u!=null){const c=()=>{u.classList.remove("blinking"),u.removeEventListener("animationend",c)};u.classList.add("blinking"),u.addEventListener("animationend",c)}}},wt=(t,e)=>{let s=e.replace(/<div class="quote">([^^]*?)<\/div>/,"").replace(/<span class="text_mask" style="([^^]*?)">([^^]*?)<\/span>/,"").replace(/<\/?[^>]+>/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/\B@([^\W_]\w*)\b/g,"＠$1");return s.length>100&&(s=s.slice(0,100)+"..."),"[quote][b]"+t+"[/b] 说: "+s+"[/quote]"},yt=t=>(t||"").trim().replace(/&nbsp;/g," ").trim();async function kt(t){return new Promise(e=>setTimeout(e,t))}const Ct=(t,e,s)=>{const o=l=>{for(const p in l){const f=l[p];let g=!1;if(e().forEach(a=>{a.id==p&&(g=!0)}),!g){const a=f.pst_id,_=f.pst_uid,r=z(f,a,_,!1);e().unshift(r)}}},i=l=>{for(const p in l){const f=l[p];let g=null;if(e().forEach(a=>{a.id==p&&(g=a)}),g!=null){const a=g,_=a.id,r=a.userId,w=a.topicSubReply.map(v=>v.id),d=f.map(v=>z(v,_,r,!0)).filter(v=>!w.includes(v.id));a.topicSubReply.push(...d)}}},u=l=>{var g,a;const p=(g=l.posts)==null?void 0:g.main;p!=null&&o(p);const f=(a=l.posts)==null?void 0:a.sub;f!=null&&i(f)},c=l=>{console.log("刷新贴贴："+JSON.stringify(l,null,2));for(const p in l){const f=l[p];t&&t(p,f),e().forEach(g=>{g.id==p&&(g.emojis=f||[]),g.topicSubReply.forEach(a=>{a.id==p&&(a.emojis=f||[])})})}};window.comment={addComment:u,refreshEmoji:c,changeSort:s}},z=(t,e,s,o=!1)=>{const i={},u=o?1:0,c=o?t.pst_id:0,l=t.pst_uid,p=t.avatar||"";return i.id=t.pst_id,i.time=t.dateline,i.userAvatar=p.startsWith("//")?"https:"+p:p,i.userName=t.nickname,i.userId=t.username,i.replyContent=t.pst_content,i.replyJs=`subReply('${t.model}', ${t.pst_mid}, ${e}, ${c}, ${l}, ${s}, ${u})`,i.topicSubReply=[],i.emojiParam={enable:!1},i.emojis=[],i},It=t=>{if(t.length===0)return;const e=document.querySelector("#post_"+t);e!=null&&e.scrollIntoView()},E={optContentJs:ft,optText:yt,optReplyItemClick:gt,optReplyContent:wt,scrollIntoView:vt,delay:kt,initComment:Ct,scrollToTargetComment:It},xt={class:"emoji-container"},St=["onClick"],$t=["src"],bt={class:"user-count"},Rt=S({__name:"EmojiView",props:{emojis:{type:Array,required:!0},comment:{type:Object,required:!0}},setup(t){const e=t,{emojis:s,comment:o}=$(e),i=c=>{try{const l=parseInt(c);return l===0?"https://bgm.tv/img/smiles/tv/44.gif":`https://bgm.tv/img/smiles/tv/${l-39}.gif`}catch{return""}},u=c=>{const l=o==null?void 0:o.value;window.android.onToggleSmile(l.id,JSON.stringify(c))};return(c,l)=>(m(),h("div",xt,[(m(!0),h(j,null,T(C(s),p=>(m(),h("div",{class:W(["emoji",{selected:p.selected}]),key:p.value,onClick:y(f=>u(p),["stop"])},[n("img",{class:"smile",src:i(p.value),alt:"smile"},null,8,$t),n("span",bt,k(p.users.length),1)],10,St))),128))]))}}),D=R(Rt,[["__scopeId","data-v-deb04d93"]]),N=t=>(L("data-v-85c9dbe6"),t=t(),V(),t),Et={class:"comment"},jt={class:"comment-title"},Tt=N(()=>n("div",{class:"title"},"用户讨论",-1)),Lt=["onClick"],Vt=N(()=>n("div",{style:{flex:"1"}},null,-1)),Nt=["id"],qt={class:"comment-content"},Bt=["onClick"],Mt=["onClick"],Jt={key:0,class:"master"},At={class:"time"},Ot={class:"floor"},Pt=N(()=>n("div",{style:{flex:"1"}},null,-1)),Ut=["onClick"],Ht={class:"topic-html-wrap"},zt=["innerHTML","onClick"],Dt={key:0,class:"anchor"},Gt=["id"],Wt=["onClick"],Ft={class:"info"},Yt=["onClick"],Kt={key:0,class:"master"},Qt={class:"time"},Xt={class:"floor"},Zt=N(()=>n("div",{style:{flex:"1"}},null,-1)),te=["onClick"],ee={class:"topic-html-wrap"},se=["innerHTML"],oe={key:0,class:"anchor"},ne=S({__name:"CommentView",props:{target:{type:String,required:!0},comments:{type:Array,default:[],required:!0},sort:{type:String,required:!0},masterId:{type:String,required:!1,default:""},anchorId:{type:String,required:!1,default:""}},setup(t){const e=t,{target:s,comments:o,sort:i}=$(e),u=a=>{switch(a){case"desc":return"最新";case"hot":return"最热";case"asc":return"时间";default:return"默认"}},c=a=>{window.android&&a.userId&&window.android&&window.android.onClickUser(a.userId,a.id)},l=(a,_,r)=>{const w=a.target;if(E.optReplyItemClick(w))return;E.scrollIntoView(a,document.querySelector(s==null?void 0:s.value),r==null);const d=(r==null?void 0:r.replyJs)||"",v=_.replyJs||"",I=d.length>0,P=I?d:v,q=r||_;if(window.android){if(P.length>0){I&&(q.replyQuote=E.optReplyContent(q.userName,q.replyContent)),window.android.onReplyUser(d.length>0?d:P,JSON.stringify(r||_));return}window.android.onNeedLogin()}},p=()=>{window.android&&window.android.onClickCommentSort()},f=(a,_)=>{window.android&&window.android.onClickCommentAction(JSON.stringify(_),a.clientX,a.clientY)},g=a=>{E.scrollIntoView(a,document.querySelector(s==null?void 0:s.value),!0),window.android&&window.android.onReplyNew()};return(a,_)=>(m(),h("div",Et,[n("div",jt,[Tt,n("div",{class:"sort",onClick:y(p,["stop"])},"排序："+k(u(C(i))),9,Lt),Vt,n("div",{class:"write",onClick:_[0]||(_[0]=y(r=>g(r),["stop"]))},"写留言")]),(m(!0),h(j,null,T(C(o),r=>{var w;return m(),h("div",{class:"comment-item",key:r.id,id:"post_"+r.id},[b(J,{class:"avatar",width:"36px",height:"36px",src:r.userAvatar,onClick:y(d=>c(r),["stop"])},null,8,["src","onClick"]),n("div",qt,[n("div",{class:"info",onClick:y(d=>l(d,r,null),["stop"])},[n("div",{class:"user-name",onClick:y(d=>c(r),["stop"])},[n("span",null,k(r.userName),1),t.masterId===r.userId?(m(),h("span",Jt,"楼主")):x("",!0)],8,Mt),n("div",At,[U(k(r.time),1),n("span",Ot,k(r.floor),1)]),Pt,(w=r.emojiParam)!=null&&w.enable?(m(),h("img",{key:0,class:"action",smileid:"",src:H,alt:"action",onClick:y(d=>f(d,r),["stop"])},null,8,Ut)):x("",!0)],8,Bt),n("div",Ht,[n("div",{class:"topic-html",innerHTML:r.replyContent,onClick:y(d=>l(d,r,null),["stop"])},null,8,zt),r.id===t.anchorId?(m(),h("div",Dt)):x("",!0)]),b(D,{emojis:r.emojis,comment:r,style:{"margin-top":"16px"}},null,8,["emojis","comment"]),(m(!0),h(j,null,T(r.topicSubReply||[],d=>{var v;return m(),h("div",{class:W(["comment-item sub",{anchor:d.id===t.anchorId}]),key:d.id,id:"post_"+d.id},[b(J,{class:"avatar",height:"24px",width:"24px",src:d.userAvatar,onClick:y(I=>c(d),["stop"])},null,8,["src","onClick"]),n("div",{class:"comment-content",onClick:y(I=>l(I,r,d),["stop"])},[n("div",Ft,[n("div",{class:"user-name sub",onClick:y(I=>c(d),["stop"])},[n("span",null,k(d.userName),1),t.masterId===d.userId?(m(),h("span",Kt,"楼主")):x("",!0)],8,Yt),n("div",Qt,[U(k(d.time),1),n("span",Xt,k(d.floor),1)]),Zt,(v=d.emojiParam)!=null&&v.enable?(m(),h("img",{key:0,class:"action",smileid:"",src:H,alt:"action",onClick:y(I=>f(I,d),["stop"])},null,8,te)):x("",!0)]),n("div",ee,[n("div",{class:"topic-html",innerHTML:d.replyContent},null,8,se),d.id===t.anchorId?(m(),h("div",oe)):x("",!0)]),b(D,{emojis:d.emojis,comment:r,style:{"margin-top":"16px"}},null,8,["emojis","comment"])],8,Wt)],10,Gt)}),128))])],8,Nt)}),128))]))}}),xe=R(ne,[["__scopeId","data-v-85c9dbe6"]]);function ie(t,e){const s=t.getBoundingClientRect();if(!e)return s.top>=0&&s.bottom<=window.innerHeight;const o=e.getBoundingClientRect();return s.top>=o.top&&s.bottom<=o.bottom}async function re(t){return await F(),t.value instanceof HTMLElement?t.value:t.value?document.querySelector(t.value):null}function G(t){let e=`0px 0px ${t.distance}px 0px`;t.top&&(e=`${t.distance}px 0px 0px 0px`);const s=new IntersectionObserver(o=>{o[0].isIntersecting&&(t.firstload&&t.emit(),t.firstload=!0)},{root:t.parentEl,rootMargin:e});return s.observe(t.infiniteLoading.value),s}const K=(t,e)=>{const s=t.__vccOpts||t;for(const[o,i]of e)s[o]=i;return s},ce={},le=t=>(L("data-v-d3e37633"),t=t(),V(),t),ae={class:"container"},de=le(()=>n("div",{class:"spinner"},null,-1)),ue=[de];function pe(t,e){return m(),h("div",ae,ue)}const _e=K(ce,[["render",pe],["__scopeId","data-v-d3e37633"]]),me={class:"state-error"},he=S({__name:"InfiniteLoading",props:{top:{type:Boolean,default:!1},target:{},distance:{default:0},identifier:{},firstload:{type:Boolean,default:!0},slots:{}},emits:["infinite"],setup(t,{emit:e}){const s=t;let o=null,i=0;const u=M(null),c=M(""),{top:l,firstload:p,distance:f}=s,{identifier:g,target:a}=$(s),_={infiniteLoading:u,top:l,firstload:p,distance:f,parentEl:null,emit(){i=(_.parentEl||document.documentElement).scrollHeight,r.loading(),e("infinite",r)}},r={loading(){c.value="loading"},async loaded(){c.value="loaded";const w=_.parentEl||document.documentElement;await F(),l&&(w.scrollTop=w.scrollHeight-i),ie(u.value,_.parentEl)&&_.emit()},complete(){c.value="complete",o==null||o.disconnect()},error(){c.value="error"}};return X(g,()=>{o==null||o.disconnect(),o=G(_)}),A(async()=>{_.parentEl=await re(a),o=G(_)}),Z(()=>{o==null||o.disconnect()}),(w,d)=>(m(),h("div",{ref_key:"infiniteLoading",ref:u,style:{"min-height":"1px"}},[tt(n("div",null,[B(w.$slots,"spinner",{},()=>[b(_e)],!0)],512),[[et,c.value=="loading"]]),c.value=="complete"?B(w.$slots,"complete",{key:0},()=>{var v;return[n("span",null,k(((v=w.slots)==null?void 0:v.complete)||"No more results!"),1)]},!0):x("",!0),c.value=="error"?B(w.$slots,"error",{key:1,retry:_.emit},()=>{var v;return[n("span",me,[n("span",null,k(((v=w.slots)==null?void 0:v.error)||"Oops something went wrong!"),1),n("button",{class:"retry",onClick:d[0]||(d[0]=(...I)=>_.emit&&_.emit(...I))},"retry")])]},!0):x("",!0)],512))}}),Se=K(he,[["__scopeId","data-v-a7077831"]]),fe=t=>(L("data-v-18fb154c"),t=t(),V(),t),ge={key:0,class:"spinner-container"},ve=fe(()=>n("div",{class:"spinner"},null,-1)),we=[ve],ye=S({__name:"BottomSpinnerView",props:{show:{type:Boolean,default:!0}},setup(t){const e=t,{show:s}=$(e);return(o,i)=>C(s)?(m(),h("div",ge,we)):x("",!0)}}),$e=R(ye,[["__scopeId","data-v-18fb154c"]]);export{$e as B,xe as C,D as E,Ce as R,Se as W,H as _,Ie as a,E as c};
