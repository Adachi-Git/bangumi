import{c,E as B,C as x,B as T,a as b,W as j}from"./BottomSpinnerView-qCvWNadZ.js";import{R as N}from"./RelativeItemView-4iw7B7w_.js";import{d as R,r as o,a as D,o as I,c as _,b as i,t as d,e as n,u as w,g,w as f,n as h,h as C}from"./index-MsVO6JuG.js";const E={key:0,class:"topic",id:"topic"},H={class:"topic-title"},J={class:"topic-info"},L={class:"topic-author"},M={class:"topic-time"},P=["innerHTML"],z={key:0,class:"divider"},y=10,A=R({__name:"TopicView",setup(F){const t=o({}),u=o(),p=o(new Date().getDate()),l=o(1),m=o("desc"),s=D([]),v=o("哼！Bangumi老娘我是有底线的人"),V={loadTopicDetail:async e=>{t.value=e,await h(),c.optContentJs(u.value)}},k=async e=>{const a=window.android.onLoadComments(l.value,y,m.value),r=JSON.parse(a);r.length==0?e.complete():(await c.delay(200),s.push(...r),l.value++,await h(),r.length<y?e.complete():e.loaded())},S=e=>{var a;return{id:(a=e.emojiParam)==null?void 0:a.likeCommentId,gh:e.gh}};return I(()=>{window.robotSay=e=>{v.value=e},window.changeCommentSort=e=>{m.value=e,l.value=1,s.length=0,p.value++},c.initComment(()=>s),window.topic=V,window.mounted=!0}),(e,a)=>t.value.id?(C(),_("div",E,[i("div",H,d(t.value.title),1),i("div",J,[i("div",L,d(t.value.userName),1),i("div",M,d(t.value.time),1)]),n(N,{related:t.value.related},null,8,["related"]),i("div",{class:"topic-content",ref_key:"topicContentRef",ref:u,innerHTML:w(c).optText(t.value.content)},null,8,P),n(B,{emojis:t.value.emojis,comment:S(t.value),style:{"margin-top":"16px"}},null,8,["emojis","comment"]),t.value.content?(C(),_("div",z)):g("",!0),n(x,{target:"#topic",comments:s,sort:m.value},null,8,["comments","sort"]),n(w(j),{class:"loading",target:"#topic",identifier:p.value,distance:300,onInfinite:k},{spinner:f(()=>[n(T)]),complete:f(()=>[n(b,{message:v.value},null,8,["message"])]),_:1},8,["identifier"])])):g("",!0)}});export{A as default};
