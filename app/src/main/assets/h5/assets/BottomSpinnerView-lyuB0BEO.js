import{d as S,q as b,r as T,o as O,h as v,c as h,b as a,t as w,u as x,p as $,l as R,_ as N,k as _,F as V,f as J,e as M,s as W,x as z,i as j,y as G,z as E,g as B,n as D}from"./index-_SfUzquW.js";import{I as U}from"./RelativeItemView-xD4QY-wp.js";const K=t=>($("data-v-3540c0b3"),t=t(),R(),t),Q={class:"robot"},X=K(()=>a("div",{style:{flex:"1"}},null,-1)),Y={class:"message"},Z=S({__name:"BottomRobotView",props:{message:{type:String,required:!0}},setup(t){const i=t,{message:o}=b(i),e=T(),s=["robot-1","robot-2","robot-3","robot-4","robot-5","robot-6"];return O(()=>{var c;const r=Math.floor(Math.random()*s.length);return(c=e.value)==null?void 0:c.classList.add(s[r])}),(r,c)=>(v(),h("div",Q,[X,a("div",{class:"robot-pic",ref_key:"robot",ref:e},null,512),a("div",Y,w(x(o)),1)]))}}),Dt=N(Z,[["__scopeId","data-v-3540c0b3"]]);function tt(t){if(!t)return;const i=t.querySelectorAll("img"),o=[];for(let e=0;e<i.length;e++){const s=i[e],r=s.src;r!=null&&r.length>0&&r.indexOf("/img/smiles")==-1&&(o.push(r),s.onclick=()=>{window.android&&window.android.onPreviewImage(r,o)})}t.querySelectorAll("span.text_mask").forEach(e=>{const s=e;s.onclick=r=>{r.preventDefault(),P(r.currentTarget)}})}const et=t=>{if(P(t))return!0;const i=t.tagName.toLowerCase();if(i=="a")return!0;if(i=="img"&&window.android){const o=t;return o.getAttribute("smileid")==null&&window.android.onPreviewImage(o.src,[o.src]),!0}return!1},P=t=>t.classList.contains("text_mask")?(t.classList.contains("show")?t.classList.remove("show"):t.classList.add("show"),!0):!1,ot=(t,i,o)=>{const e=t.currentTarget;if(e&&i){const s=e.getBoundingClientRect();i.scrollTo({top:i.scrollTop+s.top-(o?40:10),behavior:"smooth"});const r=()=>{e.classList.remove("blinking"),e.removeEventListener("animationend",r)};e.classList.add("blinking"),e.addEventListener("animationend",r)}},nt=(t,i)=>{let o=i.replace(/<div class="quote">([^^]*?)<\/div>/,"").replace(/<span class="text_mask" style="([^^]*?)">([^^]*?)<\/span>/,"").replace(/<\/?[^>]+>/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/\B@([^\W_]\w*)\b/g,"＠$1");return o.length>100&&(o=o.slice(0,100)+"..."),"[quote][b]"+t+"[/b] 说: "+o+"[/quote]"},st=t=>"　　"+(t||"").trim().replace(/&nbsp;/g," ").trim();async function it(t){return new Promise(i=>setTimeout(i,t))}const rt=t=>{const i=e=>{for(const s in e){const r=e[s];let c=!1;if(t().forEach(l=>{l.id==s&&(c=!0)}),!c){const l=r.pst_id,m=r.pst_uid,y=A(r,l,m,!1);t().unshift(y)}}},o=e=>{for(const s in e){const r=e[s];let c=null;if(t().forEach(l=>{l.id==s&&(c=l)}),c!=null){const l=c,m=l.id,y=l.userId,u=l.topicSubReply.map(n=>n.id),f=r.map(n=>A(n,m,y,!0)).filter(n=>!u.includes(n.id));l.topicSubReply.push(...f)}}};window.addComment=e=>{var c,l;const s=(c=e.posts)==null?void 0:c.main;s!=null&&i(s);const r=(l=e.posts)==null?void 0:l.sub;r!=null&&o(r)}},A=(t,i,o,e=!1)=>{const s={},r=e?1:0,c=e?t.pst_id:0,l=t.pst_uid,m=t.avatar||"";return s.id=t.pst_id,s.time=t.dateline,s.userAvatar=m.startsWith("//")?"https:"+m:m,s.userName=t.nickname,s.userId=t.username,s.replyContent=t.pst_content,s.replyJs=`subReply('${t.model}', ${t.pst_mid}, ${i}, ${c}, ${l}, ${o}, ${r})`,s.topicSubReply=[],s},I={optContentJs:tt,optText:st,optReplyItemClick:et,optReplyContent:nt,scrollIntoView:ot,delay:it,initComment:rt},q=t=>($("data-v-c1651f4c"),t=t(),R(),t),ct={class:"comment"},at={class:"comment-title"},lt=q(()=>a("div",{class:"title"},"用户讨论",-1)),dt=["onClick"],pt=q(()=>a("div",{style:{flex:"1"}},null,-1)),ut={class:"comment-content"},mt=["onClick"],ft=["onClick"],_t={class:"time"},vt=["innerHTML","onClick"],ht=q(()=>a("div",{style:{height:"12px"}},null,-1)),gt=["onClick"],wt={class:"info"},yt=["onClick"],kt={class:"time"},Ct=["innerHTML"],It=S({__name:"CommentView",props:{target:{type:String,required:!0},comments:{type:Array,default:[],required:!0},sort:{type:String,required:!0}},setup(t){const i=t,{target:o,comments:e,sort:s}=b(i),r=u=>{switch(u){case"desc":return"最新";case"hot":return"最热";default:return"时间"}},c=u=>{window.android&&u.userId&&window.android&&window.android.onClickUser(u.userId)},l=(u,f,n)=>{const d=u.target;if(I.optReplyItemClick(d))return;I.scrollIntoView(u,document.querySelector(o==null?void 0:o.value),n==null);const p=(n==null?void 0:n.replyJs)||"",k=f.replyJs||"",g=p.length>0,C=g?p:k,L=n||f;if(window.android){if(C.length>0){g&&(L.replyQuote=I.optReplyContent(L.userName,L.replyContent)),window.android.onReplyUser(p.length>0?p:C,JSON.stringify(n||f));return}window.android.onNeedLogin()}},m=()=>{window.android&&window.android.onClickCommentSort()},y=u=>{I.scrollIntoView(u,document.querySelector(o==null?void 0:o.value),!0),window.android&&window.android.onReplyNew()};return(u,f)=>(v(),h("div",ct,[a("div",at,[lt,a("div",{class:"sort",onClick:_(m,["stop"])},"排序："+w(r(x(s))),9,dt),pt,a("div",{class:"write",onClick:f[0]||(f[0]=_(n=>y(n),["stop"]))},"写留言")]),(v(!0),h(V,null,J(x(e),n=>(v(),h("div",{class:"comment-item",key:n.id},[M(U,{class:"avatar",width:"36px",height:"36px",src:n.userAvatar,onClick:_(d=>c(n),["stop"])},null,8,["src","onClick"]),a("div",ut,[a("div",{class:"info",onClick:_(d=>l(d,n,null),["stop"])},[a("div",{class:"user-name",onClick:_(d=>c(n),["stop"])},w(n.userName),9,ft),a("div",_t,w(n.time),1)],8,mt),a("div",{class:"topic-html",innerHTML:n.replyContent,onClick:_(d=>l(d,n,null),["stop"])},null,8,vt),ht,(v(!0),h(V,null,J(n.topicSubReply||[],d=>(v(),h("div",{class:"comment-item",key:d.id},[M(U,{class:"avatar",height:"24px",width:"24px",src:d.userAvatar,onClick:_(p=>c(d),["stop"])},null,8,["src","onClick"]),a("div",{class:"comment-content",onClick:_(p=>l(p,n,d),["stop"])},[a("div",wt,[a("div",{class:"user-name",onClick:_(p=>c(d),["stop"])},w(d.userName),9,yt),a("div",kt,w(d.time),1)]),a("div",{class:"topic-html",innerHTML:d.replyContent},null,8,Ct)],8,gt)]))),128))])]))),128))]))}}),Pt=N(It,[["__scopeId","data-v-c1651f4c"]]);function xt(t,i){const o=t.getBoundingClientRect();if(!i)return o.top>=0&&o.bottom<=window.innerHeight;const e=i.getBoundingClientRect();return o.top>=e.top&&o.bottom<=e.bottom}async function St(t){return await D(),t.value instanceof HTMLElement?t.value:t.value?document.querySelector(t.value):null}function H(t){let i=`0px 0px ${t.distance}px 0px`;t.top&&(i=`${t.distance}px 0px 0px 0px`);const o=new IntersectionObserver(e=>{e[0].isIntersecting&&(t.firstload&&t.emit(),t.firstload=!0)},{root:t.parentEl,rootMargin:i});return o.observe(t.infiniteLoading.value),o}const F=(t,i)=>{const o=t.__vccOpts||t;for(const[e,s]of i)o[e]=s;return o},bt={},$t=t=>($("data-v-d3e37633"),t=t(),R(),t),Rt={class:"container"},Lt=$t(()=>a("div",{class:"spinner"},null,-1)),Et=[Lt];function Tt(t,i){return v(),h("div",Rt,Et)}const Mt=F(bt,[["render",Tt],["__scopeId","data-v-d3e37633"]]),Bt={class:"state-error"},Nt=S({__name:"InfiniteLoading",props:{top:{type:Boolean,default:!1},target:{},distance:{default:0},identifier:{},firstload:{type:Boolean,default:!0},slots:{}},emits:["infinite"],setup(t,{emit:i}){const o=t;let e=null,s=0;const r=T(null),c=T(""),{top:l,firstload:m,distance:y}=o,{identifier:u,target:f}=b(o),n={infiniteLoading:r,top:l,firstload:m,distance:y,parentEl:null,emit(){s=(n.parentEl||document.documentElement).scrollHeight,d.loading(),i("infinite",d)}},d={loading(){c.value="loading"},async loaded(){c.value="loaded";const p=n.parentEl||document.documentElement;await D(),l&&(p.scrollTop=p.scrollHeight-s),xt(r.value,n.parentEl)&&n.emit()},complete(){c.value="complete",e==null||e.disconnect()},error(){c.value="error"}};return W(u,()=>{e==null||e.disconnect(),e=H(n)}),O(async()=>{n.parentEl=await St(f),e=H(n)}),z(()=>{e==null||e.disconnect()}),(p,k)=>(v(),h("div",{ref_key:"infiniteLoading",ref:r,style:{"min-height":"1px"}},[j(a("div",null,[E(p.$slots,"spinner",{},()=>[M(Mt)],!0)],512),[[G,c.value=="loading"]]),c.value=="complete"?E(p.$slots,"complete",{key:0},()=>{var g;return[a("span",null,w(((g=p.slots)==null?void 0:g.complete)||"No more results!"),1)]},!0):B("",!0),c.value=="error"?E(p.$slots,"error",{key:1,retry:n.emit},()=>{var g;return[a("span",Bt,[a("span",null,w(((g=p.slots)==null?void 0:g.error)||"Oops something went wrong!"),1),a("button",{class:"retry",onClick:k[0]||(k[0]=(...C)=>n.emit&&n.emit(...C))},"retry")])]},!0):B("",!0)],512))}}),Ft=F(Nt,[["__scopeId","data-v-a7077831"]]),qt=t=>($("data-v-18fb154c"),t=t(),R(),t),Vt={key:0,class:"spinner-container"},Jt=qt(()=>a("div",{class:"spinner"},null,-1)),Ut=[Jt],At=S({__name:"BottomSpinnerView",props:{show:{type:Boolean,default:!0}},setup(t){const i=t,{show:o}=b(i);return(e,s)=>x(o)?(v(),h("div",Vt,Ut)):B("",!0)}}),Wt=N(At,[["__scopeId","data-v-18fb154c"]]);export{Wt as B,Pt as C,Ft as W,Dt as a,I as c};
