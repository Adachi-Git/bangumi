import{d as C,q as I,r as E,o as U,h as _,c as v,b as i,t as h,u as x,p as S,l as b,_ as V,k as u,F as M,f as H,e as q,s as P,x as F,i as z,y as W,z as B,g as N,n as O}from"./index-x_J9GbU6.js";import{I as J}from"./RelativeItemView-nMkPZsP4.js";const j=t=>(S("data-v-3540c0b3"),t=t(),b(),t),G={class:"robot"},K=j(()=>i("div",{style:{flex:"1"}},null,-1)),Q={class:"message"},X=C({__name:"BottomRobotView",props:{message:{type:String,required:!0}},setup(t){const s=t,{message:e}=I(s),o=E(),c=["robot-1","robot-2","robot-3","robot-4","robot-5","robot-6"];return U(()=>{var d;const r=Math.floor(Math.random()*c.length);return(d=o.value)==null?void 0:d.classList.add(c[r])}),(r,d)=>(_(),v("div",G,[K,i("div",{class:"robot-pic",ref_key:"robot",ref:o},null,512),i("div",Q,h(x(e)),1)]))}}),Ut=V(X,[["__scopeId","data-v-3540c0b3"]]);function Y(t){if(!t)return;const s=t.querySelectorAll("img"),e=[];for(let o=0;o<s.length;o++){const c=s[o],r=c.src;r!=null&&r.length>0&&r.indexOf("/img/smiles")==-1&&(e.push(r),c.onclick=()=>{window.android&&window.android.onPreviewImage(r,e)})}t.querySelectorAll("span.text_mask").forEach(o=>{const c=o;c.onclick=r=>{r.preventDefault(),c.style.color="white"}})}const Z=t=>{if(t.classList.contains("text_mask"))return t.classList.contains("show")?t.classList.remove("show"):t.classList.add("show"),!0;const s=t.tagName.toLowerCase();if(s=="a")return!0;if(s=="img"&&window.android){const e=t;return e.getAttribute("smileid")==null&&window.android.onPreviewImage(e.src,[e.src]),!0}return!1},tt=(t,s,e)=>{const o=t.currentTarget;if(o&&s){const c=o.getBoundingClientRect();s.scrollTo({top:s.scrollTop+c.top-(e?40:10),behavior:"smooth"});const r=()=>{o.classList.remove("blinking"),o.removeEventListener("animationend",r)};o.classList.add("blinking"),o.addEventListener("animationend",r)}},et=(t,s)=>{let e=s.replace(/<div class="quote">([^^]*?)<\/div>/,"").replace(/<span class="text_mask" style="([^^]*?)">([^^]*?)<\/span>/,"").replace(/<\/?[^>]+>/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/\B@([^\W_]\w*)\b/g,"＠$1");return e.length>100&&(e=e.slice(0,100)+"..."),"[quote][b]"+t+"[/b] 说: "+e+"[/quote]"},ot=t=>"　　"+(t||"").trim().replace(/&nbsp;/g," ").trim();async function nt(t){return new Promise(s=>setTimeout(s,t))}const k={optContentJs:Y,optText:ot,optReplyItemClick:Z,optReplyContent:et,scrollIntoView:tt,delay:nt},T=t=>(S("data-v-0afb16b4"),t=t(),b(),t),st={class:"comment"},it={class:"comment-title"},rt=T(()=>i("div",{class:"title"},"用户讨论",-1)),ct=["onClick"],lt=T(()=>i("div",{style:{flex:"1"}},null,-1)),at={class:"comment-content"},dt=["onClick"],pt=["onClick"],ut={class:"time"},_t=["innerHTML","onClick"],vt=T(()=>i("div",{style:{height:"12px"}},null,-1)),ft={class:"comment-item"},mt=["onClick"],ht={class:"info"},wt=["onClick"],gt={class:"time"},yt=["innerHTML"],kt=C({__name:"CommentView",props:{target:{type:String,required:!0},comments:{type:Array,default:[],required:!0},sort:{type:String,required:!0}},setup(t){const s=t,{target:e,comments:o,sort:c}=I(s),r=p=>{switch(p){case"desc":return"最新";case"hot":return"最热";default:return"时间"}},d=p=>{window.android&&p.userId&&window.android&&window.android.onClickUser(p.userId)},w=(p,f,n)=>{const l=p.target;if(k.optReplyItemClick(l))return;k.scrollIntoView(p,document.querySelector(e==null?void 0:e.value),n==null);const a=(n==null?void 0:n.replyJs)||"",g=f.replyJs||"",m=a.length>0,y=m?a:g,R=n||f;if(window.android){if(y.length>0){m&&(R.replyQuote=k.optReplyContent(R.userName,R.replyContent)),window.android.onReplyUser(a.length>0?a:y,JSON.stringify(n||f));return}window.android.onNeedLogin()}},L=()=>{window.android&&window.android.onClickCommentSort()},$=p=>{k.scrollIntoView(p,document.querySelector(e==null?void 0:e.value),!0),window.android&&window.android.onReplyNew()};return(p,f)=>(_(),v("div",st,[i("div",it,[rt,i("div",{class:"sort",onClick:u(L,["stop"])},"排序："+h(r(x(c))),9,ct),lt,i("div",{class:"write",onClick:f[0]||(f[0]=u(n=>$(n),["stop"]))},"写留言")]),(_(!0),v(M,null,H(x(o),n=>(_(),v("div",{class:"comment-item",key:n.id},[q(J,{class:"avatar",width:"36px",height:"36px",src:n.userAvatar,onClick:u(l=>d(n),["stop"])},null,8,["src","onClick"]),i("div",at,[i("div",{class:"info",onClick:u(l=>w(l,n,null),["stop"])},[i("div",{class:"user-name",onClick:u(l=>d(n),["stop"])},h(n.userName),9,pt),i("div",ut,h(n.time),1)],8,dt),i("div",{class:"topic-html",innerHTML:n.replyContent,onClick:u(l=>w(l,n,null),["stop"])},null,8,_t),vt,(_(!0),v(M,null,H(n.topicSubReply||[],l=>(_(),v("div",ft,[q(J,{class:"avatar",height:"24px",width:"24px",src:l.userAvatar,onClick:u(a=>d(l),["stop"])},null,8,["src","onClick"]),i("div",{class:"comment-content",onClick:u(a=>w(a,n,l),["stop"])},[i("div",ht,[i("div",{class:"user-name",onClick:u(a=>d(l),["stop"])},h(l.userName),9,wt),i("div",gt,h(l.time),1)]),i("div",{class:"topic-html",innerHTML:l.replyContent},null,8,yt)],8,mt)]))),256))])]))),128))]))}}),Ot=V(kt,[["__scopeId","data-v-0afb16b4"]]);function xt(t,s){const e=t.getBoundingClientRect();if(!s)return e.top>=0&&e.bottom<=window.innerHeight;const o=s.getBoundingClientRect();return e.top>=o.top&&e.bottom<=o.bottom}async function Ct(t){return await O(),t.value instanceof HTMLElement?t.value:t.value?document.querySelector(t.value):null}function A(t){let s=`0px 0px ${t.distance}px 0px`;t.top&&(s=`${t.distance}px 0px 0px 0px`);const e=new IntersectionObserver(o=>{o[0].isIntersecting&&(t.firstload&&t.emit(),t.firstload=!0)},{root:t.parentEl,rootMargin:s});return e.observe(t.infiniteLoading.value),e}const D=(t,s)=>{const e=t.__vccOpts||t;for(const[o,c]of s)e[o]=c;return e},It={},St=t=>(S("data-v-d3e37633"),t=t(),b(),t),bt={class:"container"},Lt=St(()=>i("div",{class:"spinner"},null,-1)),$t=[Lt];function Rt(t,s){return _(),v("div",bt,$t)}const Bt=D(It,[["render",Rt],["__scopeId","data-v-d3e37633"]]),Et={class:"state-error"},qt=C({__name:"InfiniteLoading",props:{top:{type:Boolean,default:!1},target:{},distance:{default:0},identifier:{},firstload:{type:Boolean,default:!0},slots:{}},emits:["infinite"],setup(t,{emit:s}){const e=t;let o=null,c=0;const r=E(null),d=E(""),{top:w,firstload:L,distance:$}=e,{identifier:p,target:f}=I(e),n={infiniteLoading:r,top:w,firstload:L,distance:$,parentEl:null,emit(){c=(n.parentEl||document.documentElement).scrollHeight,l.loading(),s("infinite",l)}},l={loading(){d.value="loading"},async loaded(){d.value="loaded";const a=n.parentEl||document.documentElement;await O(),w&&(a.scrollTop=a.scrollHeight-c),xt(r.value,n.parentEl)&&n.emit()},complete(){d.value="complete",o==null||o.disconnect()},error(){d.value="error"}};return P(p,()=>{o==null||o.disconnect(),o=A(n)}),U(async()=>{n.parentEl=await Ct(f),o=A(n)}),F(()=>{o==null||o.disconnect()}),(a,g)=>(_(),v("div",{ref_key:"infiniteLoading",ref:r,style:{"min-height":"1px"}},[z(i("div",null,[B(a.$slots,"spinner",{},()=>[q(Bt)],!0)],512),[[W,d.value=="loading"]]),d.value=="complete"?B(a.$slots,"complete",{key:0},()=>{var m;return[i("span",null,h(((m=a.slots)==null?void 0:m.complete)||"No more results!"),1)]},!0):N("",!0),d.value=="error"?B(a.$slots,"error",{key:1,retry:n.emit},()=>{var m;return[i("span",Et,[i("span",null,h(((m=a.slots)==null?void 0:m.error)||"Oops something went wrong!"),1),i("button",{class:"retry",onClick:g[0]||(g[0]=(...y)=>n.emit&&n.emit(...y))},"retry")])]},!0):N("",!0)],512))}}),Dt=D(qt,[["__scopeId","data-v-a7077831"]]),Nt=t=>(S("data-v-18fb154c"),t=t(),b(),t),Vt={key:0,class:"spinner-container"},Tt=Nt(()=>i("div",{class:"spinner"},null,-1)),Mt=[Tt],Ht=C({__name:"BottomSpinnerView",props:{show:{type:Boolean,default:!0}},setup(t){const s=t,{show:e}=I(s);return(o,c)=>x(e)?(_(),v("div",Vt,Mt)):N("",!0)}}),Pt=V(Ht,[["__scopeId","data-v-18fb154c"]]);export{Pt as B,Ot as C,Dt as W,Ut as a,k as c};
