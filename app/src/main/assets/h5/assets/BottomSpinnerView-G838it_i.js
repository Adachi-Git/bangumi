import{d as C,q as b,r as q,o as H,h as g,c as v,b as a,t as h,u as k,p as R,l as E,_ as L,F as M,f as N,j as D,k as _,e as x,s as F,x as W,i as G,y as K,z as j,g as B,n as O}from"./index-Y4DqAXNG.js";import{I as A}from"./RelativeItemView-bXZMLnj1.js";const Q=t=>(R("data-v-3540c0b3"),t=t(),E(),t),X={class:"robot"},Y=Q(()=>a("div",{style:{flex:"1"}},null,-1)),Z={class:"message"},tt=C({__name:"BottomRobotView",props:{message:{type:String,required:!0}},setup(t){const i=t,{message:s}=b(i),e=q(),o=["robot-1","robot-2","robot-3","robot-4","robot-5","robot-6"];return H(()=>{var r;const c=Math.floor(Math.random()*o.length);return(r=e.value)==null?void 0:r.classList.add(o[c])}),(c,r)=>(g(),v("div",X,[Y,a("div",{class:"robot-pic",ref_key:"robot",ref:e},null,512),a("div",Z,h(k(s)),1)]))}}),Kt=L(tt,[["__scopeId","data-v-3540c0b3"]]);function et(t){if(!t)return;const i=t.querySelectorAll("img"),s=[];for(let e=0;e<i.length;e++){const o=i[e],c=o.src;c!=null&&c.length>0&&c.indexOf("/img/smiles")==-1&&(s.push(c),o.onclick=()=>{window.android&&window.android.onPreviewImage(c,s)})}t.querySelectorAll("span.text_mask").forEach(e=>{const o=e;o.onclick=c=>{c.preventDefault(),P(c.currentTarget)}})}const st=t=>{if(P(t))return!0;const i=t.tagName.toLowerCase();if(i=="a")return!0;if(i=="img"&&window.android){const s=t;return s.getAttribute("smileid")==null&&window.android.onPreviewImage(s.src,[s.src]),!0}return!1},P=t=>t.classList.contains("text_mask")?(t.classList.contains("show")?t.classList.remove("show"):t.classList.add("show"),!0):!1,ot=(t,i,s)=>{const e=t.currentTarget;if(e&&i){const o=e.getBoundingClientRect();i.scrollTo({top:i.scrollTop+o.top-(s?40:10),behavior:"smooth"});const c=()=>{e.classList.remove("blinking"),e.removeEventListener("animationend",c)};e.classList.add("blinking"),e.addEventListener("animationend",c)}},nt=(t,i)=>{let s=i.replace(/<div class="quote">([^^]*?)<\/div>/,"").replace(/<span class="text_mask" style="([^^]*?)">([^^]*?)<\/span>/,"").replace(/<\/?[^>]+>/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/\B@([^\W_]\w*)\b/g,"＠$1");return s.length>100&&(s=s.slice(0,100)+"..."),"[quote][b]"+t+"[/b] 说: "+s+"[/quote]"},it=t=>"　　"+(t||"").trim().replace(/&nbsp;/g," ").trim();async function rt(t){return new Promise(i=>setTimeout(i,t))}const ct=t=>{const i=e=>{for(const o in e){const c=e[o];let r=!1;if(t().forEach(l=>{l.id==o&&(r=!0)}),!r){const l=c.pst_id,p=c.pst_uid,w=J(c,l,p,!1);t().unshift(w)}}},s=e=>{for(const o in e){const c=e[o];let r=null;if(t().forEach(l=>{l.id==o&&(r=l)}),r!=null){const l=r,p=l.id,w=l.userId,m=l.topicSubReply.map(n=>n.id),f=c.map(n=>J(n,p,w,!0)).filter(n=>!m.includes(n.id));l.topicSubReply.push(...f)}}};window.addComment=e=>{var r,l;const o=(r=e.posts)==null?void 0:r.main;o!=null&&i(o);const c=(l=e.posts)==null?void 0:l.sub;c!=null&&s(c)},window.refreshCommentEmoji=e=>{for(const o in e){const c=e[o];t().forEach(r=>{r.id==o&&(r.emojis=c||[]),r.topicSubReply.forEach(l=>{l.id==o&&(l.emojis=c||[])})})}}},J=(t,i,s,e=!1)=>{const o={},c=e?1:0,r=e?t.pst_id:0,l=t.pst_uid,p=t.avatar||"";return o.id=t.pst_id,o.time=t.dateline,o.userAvatar=p.startsWith("//")?"https:"+p:p,o.userName=t.nickname,o.userId=t.username,o.replyContent=t.pst_content,o.replyJs=`subReply('${t.model}', ${t.pst_mid}, ${i}, ${r}, ${l}, ${s}, ${c})`,o.topicSubReply=[],o},$={optContentJs:et,optText:it,optReplyItemClick:st,optReplyContent:nt,scrollIntoView:ot,delay:rt,initComment:ct},lt={class:"emoji-container"},at=["onClick"],dt=["src"],pt={class:"user-count"},ut=C({__name:"EmojiView",props:{emojis:{type:Array,required:!0},comment:{type:Object,required:!0}},setup(t){const i=t,{emojis:s,comment:e}=b(i),o=r=>({0:"https://bgm.tv/img/smiles/tv/44.gif",79:"https://bgm.tv/img/smiles/tv/40.gif",54:"https://bgm.tv/img/smiles/tv/15.gif",140:"https://bgm.tv/img/smiles/tv/101.gif",62:"https://bgm.tv/img/smiles/tv/23.gif",122:"https://bgm.tv/img/smiles/tv/83.gif",104:"https://bgm.tv/img/smiles/tv/65.gif",80:"https://bgm.tv/img/smiles/tv/41.gif",141:"https://bgm.tv/img/smiles/tv/102.gif",88:"https://bgm.tv/img/smiles/tv/49.gif",85:"https://bgm.tv/img/smiles/tv/46.gif",90:"https://bgm.tv/img/smiles/tv/51.gif"})[r.toString()],c=r=>{const l=e==null?void 0:e.value;window.android.onToggleSmile(l.id,l.gh,JSON.stringify(r))};return(r,l)=>(g(),v("div",lt,[(g(!0),v(M,null,N(k(s),p=>(g(),v("div",{class:D(["emoji",{selected:p.selected}]),key:p.value,onClick:_(w=>c(p),["stop"])},[a("img",{class:"smile",src:o(p.value),alt:"smile"},null,8,dt),a("span",pt,h(p.users.length),1)],10,at))),128))]))}}),mt=L(ut,[["__scopeId","data-v-396c937e"]]),V=t=>(R("data-v-e0f039ac"),t=t(),E(),t),gt={class:"comment"},vt={class:"comment-title"},ft=V(()=>a("div",{class:"title"},"用户讨论",-1)),_t=["onClick"],ht=V(()=>a("div",{style:{flex:"1"}},null,-1)),wt={class:"comment-content"},yt=["onClick"],kt=["onClick"],Ct={class:"time"},bt=["innerHTML","onClick"],It=V(()=>a("div",{style:{height:"12px"}},null,-1)),St=["onClick"],$t={class:"info"},xt=["onClick"],Rt={class:"time"},Et=["innerHTML"],Lt=C({__name:"CommentView",props:{target:{type:String,required:!0},comments:{type:Array,default:[],required:!0},sort:{type:String,required:!0}},setup(t){const i=t,{target:s,comments:e,sort:o}=b(i),c=m=>{switch(m){case"desc":return"最新";case"hot":return"最热";default:return"时间"}},r=m=>{window.android&&m.userId&&window.android&&window.android.onClickUser(m.id,m.userId)},l=(m,f,n)=>{const d=m.target;if($.optReplyItemClick(d))return;$.scrollIntoView(m,document.querySelector(s==null?void 0:s.value),n==null);const u=(n==null?void 0:n.replyJs)||"",I=f.replyJs||"",y=u.length>0,S=y?u:I,T=n||f;if(window.android){if(S.length>0){y&&(T.replyQuote=$.optReplyContent(T.userName,T.replyContent)),window.android.onReplyUser(u.length>0?u:S,JSON.stringify(n||f));return}window.android.onNeedLogin()}},p=()=>{window.android&&window.android.onClickCommentSort()},w=m=>{$.scrollIntoView(m,document.querySelector(s==null?void 0:s.value),!0),window.android&&window.android.onReplyNew()};return(m,f)=>(g(),v("div",gt,[a("div",vt,[ft,a("div",{class:"sort",onClick:_(p,["stop"])},"排序："+h(c(k(o))),9,_t),ht,a("div",{class:"write",onClick:f[0]||(f[0]=_(n=>w(n),["stop"]))},"写留言")]),(g(!0),v(M,null,N(k(e),n=>(g(),v("div",{class:"comment-item",key:n.id},[x(A,{class:"avatar",width:"36px",height:"36px",src:n.userAvatar,onClick:_(d=>r(n),["stop"])},null,8,["src","onClick"]),a("div",wt,[a("div",{class:"info",onClick:_(d=>l(d,n,null),["stop"])},[a("div",{class:"user-name",onClick:_(d=>r(n),["stop"])},h(n.userName),9,kt),a("div",Ct,h(n.time),1)],8,yt),a("div",{class:"topic-html",innerHTML:n.replyContent,onClick:_(d=>l(d,n,null),["stop"])},null,8,bt),x(mt,{emojis:n.emojis,comment:n,style:{"margin-top":"16px"}},null,8,["emojis","comment"]),It,(g(!0),v(M,null,N(n.topicSubReply||[],d=>(g(),v("div",{class:"comment-item",key:d.id},[x(A,{class:"avatar",height:"24px",width:"24px",src:d.userAvatar,onClick:_(u=>r(d),["stop"])},null,8,["src","onClick"]),a("div",{class:"comment-content",onClick:_(u=>l(u,n,d),["stop"])},[a("div",$t,[a("div",{class:"user-name",onClick:_(u=>r(d),["stop"])},h(d.userName),9,xt),a("div",Rt,h(d.time),1)]),a("div",{class:"topic-html",innerHTML:d.replyContent},null,8,Et)],8,St)]))),128))])]))),128))]))}}),Qt=L(Lt,[["__scopeId","data-v-e0f039ac"]]);function Tt(t,i){const s=t.getBoundingClientRect();if(!i)return s.top>=0&&s.bottom<=window.innerHeight;const e=i.getBoundingClientRect();return s.top>=e.top&&s.bottom<=e.bottom}async function jt(t){return await O(),t.value instanceof HTMLElement?t.value:t.value?document.querySelector(t.value):null}function U(t){let i=`0px 0px ${t.distance}px 0px`;t.top&&(i=`${t.distance}px 0px 0px 0px`);const s=new IntersectionObserver(e=>{e[0].isIntersecting&&(t.firstload&&t.emit(),t.firstload=!0)},{root:t.parentEl,rootMargin:i});return s.observe(t.infiniteLoading.value),s}const z=(t,i)=>{const s=t.__vccOpts||t;for(const[e,o]of i)s[e]=o;return s},qt={},Mt=t=>(R("data-v-d3e37633"),t=t(),E(),t),Nt={class:"container"},Bt=Mt(()=>a("div",{class:"spinner"},null,-1)),Vt=[Bt];function At(t,i){return g(),v("div",Nt,Vt)}const Jt=z(qt,[["render",At],["__scopeId","data-v-d3e37633"]]),Ut={class:"state-error"},Ht=C({__name:"InfiniteLoading",props:{top:{type:Boolean,default:!1},target:{},distance:{default:0},identifier:{},firstload:{type:Boolean,default:!0},slots:{}},emits:["infinite"],setup(t,{emit:i}){const s=t;let e=null,o=0;const c=q(null),r=q(""),{top:l,firstload:p,distance:w}=s,{identifier:m,target:f}=b(s),n={infiniteLoading:c,top:l,firstload:p,distance:w,parentEl:null,emit(){o=(n.parentEl||document.documentElement).scrollHeight,d.loading(),i("infinite",d)}},d={loading(){r.value="loading"},async loaded(){r.value="loaded";const u=n.parentEl||document.documentElement;await O(),l&&(u.scrollTop=u.scrollHeight-o),Tt(c.value,n.parentEl)&&n.emit()},complete(){r.value="complete",e==null||e.disconnect()},error(){r.value="error"}};return F(m,()=>{e==null||e.disconnect(),e=U(n)}),H(async()=>{n.parentEl=await jt(f),e=U(n)}),W(()=>{e==null||e.disconnect()}),(u,I)=>(g(),v("div",{ref_key:"infiniteLoading",ref:c,style:{"min-height":"1px"}},[G(a("div",null,[j(u.$slots,"spinner",{},()=>[x(Jt)],!0)],512),[[K,r.value=="loading"]]),r.value=="complete"?j(u.$slots,"complete",{key:0},()=>{var y;return[a("span",null,h(((y=u.slots)==null?void 0:y.complete)||"No more results!"),1)]},!0):B("",!0),r.value=="error"?j(u.$slots,"error",{key:1,retry:n.emit},()=>{var y;return[a("span",Ut,[a("span",null,h(((y=u.slots)==null?void 0:y.error)||"Oops something went wrong!"),1),a("button",{class:"retry",onClick:I[0]||(I[0]=(...S)=>n.emit&&n.emit(...S))},"retry")])]},!0):B("",!0)],512))}}),Xt=z(Ht,[["__scopeId","data-v-a7077831"]]),Ot=t=>(R("data-v-18fb154c"),t=t(),E(),t),Pt={key:0,class:"spinner-container"},zt=Ot(()=>a("div",{class:"spinner"},null,-1)),Dt=[zt],Ft=C({__name:"BottomSpinnerView",props:{show:{type:Boolean,default:!0}},setup(t){const i=t,{show:s}=b(i);return(e,o)=>k(s)?(g(),v("div",Pt,Dt)):B("",!0)}}),Yt=L(Ft,[["__scopeId","data-v-18fb154c"]]);export{Yt as B,Qt as C,Xt as W,Kt as a,$ as c};
