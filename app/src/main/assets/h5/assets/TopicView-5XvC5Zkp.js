import{d as b,r as i,a as x,o as T,c as d,b as s,t as w,g as r,w as k,e as a,u as h,h as j,n as y,i as u}from"./index-_nhc96TF.js";import{c as p,R,E as D,_ as E,C as J,B as M,a as H,W as L}from"./BottomSpinnerView-n6G69cM2.js";const U={key:0,class:"topic",id:"topic"},A={class:"topic-title"},O=["onClick"],z={key:0,class:"topic-author"},F={class:"topic-time"},W=["innerHTML"],X={key:0,class:"emoji"},Y=s("div",{style:{flex:"1"}},null,-1),q={key:1,class:"divider"},S=10,Z=b({__name:"TopicView",setup(G){const o=i({}),_=i(),C=i(new Date().getDate()),v=i(1),c=i("default"),m=x([]),f=i("哼！Bangumi老娘我是有底线的人"),V={loadTopicDetail:async e=>{o.value=e,await y(),p.optContentJs(_.value)}},B=async e=>{const t=window.android.onCommentSort(c.value),n=window.android.onLoadComments(v.value,S,t),l=JSON.parse(n);c.value=t,l.length==0?e.complete():(await p.delay(200),m.push(...l),v.value++,await y(),l.length<S?e.complete():e.loaded())},g=e=>{var t;return{emojiParam:e.emojiParam,id:(t=e.emojiParam)==null?void 0:t.likeCommentId}},I=e=>{let t=g(o.value);window.android&&window.android.onClickCommentAction(JSON.stringify(t),e.clientX,e.clientY)},N=(e,t)=>{e==o.value.emojiParam.likeCommentId&&(o.value.emojis=t)},P=()=>{var t,n;const e=((t=o.value)==null?void 0:t.userId)||"";window.android&&e&&window.android&&window.android.onClickUser(e,(n=o.value)==null?void 0:n.id)};return T(()=>{window.robotSay=e=>{f.value=e},p.initComment(N,()=>m,e=>{c.value=e,v.value=1,m.length=0,C.value++}),window.topic=V,window.mounted=!0}),(e,t)=>{var n;return o.value.id?(u(),d("div",U,[s("div",A,w(o.value.title),1),s("div",{class:"topic-info",onClick:k(P,["stop"])},[o.value.userName?(u(),d("div",z,w(o.value.userName),1)):r("",!0),s("div",F,w(o.value.time),1)],8,O),a(R,{related:o.value.related},null,8,["related"]),s("div",{class:"topic-content",ref_key:"topicContentRef",ref:_,innerHTML:h(p).optText(o.value.content)},null,8,W),(n=o.value.emojiParam)!=null&&n.enable?(u(),d("div",X,[a(D,{class:"topic-emoji",emojis:o.value.emojis,comment:g(o.value)},null,8,["emojis","comment"]),Y,s("img",{class:"action",smileid:"",src:E,alt:"action",onClick:t[0]||(t[0]=k(l=>I(l),["stop"]))})])):r("",!0),o.value.content?(u(),d("div",q)):r("",!0),a(J,{target:"#topic",comments:m,sort:c.value},null,8,["comments","sort"]),a(h(L),{class:"loading",target:"#topic",identifier:C.value,distance:300,onInfinite:B},{spinner:j(()=>[a(M)]),complete:j(()=>[a(H,{message:f.value},null,8,["message"])]),_:1},8,["identifier"])])):r("",!0)}}});export{Z as default};
